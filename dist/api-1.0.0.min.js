
(function(){function c(){this.connection={}}var a=require("../utils/copy").copy,b=require("../domain/core").Event;c.prototype.track=function(c){var d=new b(c),e=a(this.connection);e.host=e.host,e.path="/"+d.type+"/"+d.ad_id;if(d.validate()){e.qs=d;var f=request().get(e,function(a,b){console.log(b)});this.connection.next(f)}},exports.Tracker=c})(),function(){var a=require("../node_modules/events").events.EventEmitter,b=require("../domain/page").Page,c=require("../request/request").request,d=require("../spaces/spaces").spaces,e=function(){b.apply(this,arguments),a.apply(this,arguments),this.document,this.tracker,this.connection};e.prototype.getData=function(a){var b=this.connection.id(),d=copy(this.connection);d.host=d.host,d.path="/pages/"+this.id,d.qs={callback:"adlayer.connections.adserver.requests."+b+".callback",domain:this.domain,site_id:this.site_id};var e=c().get(d,a);this.connection.requests[b]=e},e.prototype.scanSpaces=function(a,b){for(var c=0;c<a.length;c++){var e=a[c];e.document=this.document,e=d.create(a[c]),e.element=e.getElement();if(e.element)b(null,e);else{var f={error:"not found",id:e._id};b(f,null)}}},exports.PageApi=e}(),function(a){var b=require("../node_modules/querystring").querystring,c=require("../utils/copy").copy,d=require("../connection/connection").Connection,e=require("./page").PageApi,f=require("./tracker").Tracker,g=require("../config/config").config,h=require("../ads/ads").ads,i={},j={};e.renderSpace=function(a,b,c){var d=h.create(a.getAd());d.tracker=c,d=d.init(a,b),a.placeAd(d),j[d.id]=d},e.prototype.init=function(){var a=this;return this.getData(function(b,c){c&&c.spaces&&a.scanSpaces(c.spaces,function(b,c){if(!b){var d={domain:a.domain,page_url:a.url,page_id:a.id,site_id:a.site_id};e.renderSpace(c,d,n),i[c.id]=c}})}),a},a.adlayer=a.adlayer||{};var k=a.adlayer,l=k.config||g,m={adserver:new d(l.url.adserver),tracker:new d(l.url.tracker)},n=new f;n.connection=m.tracker,k.page={},k.config=l,k.connections=m,k.spaces=i,k.ads=j,function(){var d=a.document;if(l.page.autoRun&&d){var f=d.getElementById(l.page.scriptTagId),g=f.src.split("?")[1],h=b.parse(g);l.site_id=l.site_id||h.site,l.domain=l.domain||a.location.hostname,l.page_id=l.page_id||h.page,l.page_url=l.page_url||a.location.href,k.page=new e({tracker:n,id:l.page_id,url:l.page_url,site_id:l.site_id,domain:l.domain,connection:m.adserver,document:d}),k.page.init()}}()}(this)